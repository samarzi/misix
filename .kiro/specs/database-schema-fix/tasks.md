# Implementation Plan

- [ ] 1. Создать SQL миграцию для исправления схемы users
  - Создать файл `backend/migrations/008_fix_users_nullable.sql`
  - Добавить ALTER TABLE команды для изменения email и password_hash на nullable
  - Добавить CHECK constraint для валидации типов пользователей
  - Сделать миграцию идемпотентной с использованием IF EXISTS
  - _Requirements: 1.1, 1.2, 3.1, 3.2_

- [ ] 2. Создать Python скрипт для применения миграции
  - Создать файл `backend/apply_schema_fix.py`
  - Реализовать чтение SQL файла миграции
  - Реализовать подключение к Supabase через существующий client
  - Реализовать выполнение SQL через Supabase PostgREST API или прямое подключение
  - Добавить логирование успеха/ошибок
  - _Requirements: 3.3, 3.4_

- [ ] 3. Обновить документацию по применению фикса
  - Создать файл `backend/SCHEMA_FIX_INSTRUCTIONS.md`
  - Описать проблему и решение
  - Добавить пошаговые инструкции по применению
  - Добавить команды для проверки результата
  - _Requirements: 3.3_

- [ ] 4. Checkpoint - Применить миграцию и проверить результат
  - Запустить скрипт применения миграции
  - Проверить, что колонки стали nullable
  - Проверить, что database validator проходит успешно
  - Перезапустить приложение и проверить логи
  - Протестировать бота отправкой сообщения
  - _Requirements: 1.5, 2.1, 2.2, 2.3, 2.4_
