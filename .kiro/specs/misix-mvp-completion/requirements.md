# Requirements Document: MISIX MVP Completion

## Introduction

Этот документ описывает требования для завершения MVP (Minimum Viable Product) проекта MISIX - интеллектуального личного помощника. Цель - реализовать ключевые функции из ТЗ, которые обеспечат полноценное естественное общение с автоматическим извлечением и сохранением данных.

## Glossary

- **MISIX System**: Интеллектуальный личный помощник с Telegram ботом и веб-интерфейсом
- **Intent Classification**: Процесс определения намерения пользователя из текста сообщения
- **Data Extraction**: Извлечение структурированных данных из естественного языка
- **User Message**: Текстовое или голосовое сообщение от пользователя
- **Entity**: Структурированный объект данных (задача, расход, заметка, настроение)
- **Telegram Bot**: Интерфейс взаимодействия через Telegram
- **Web Dashboard**: Веб-интерфейс для управления данными
- **Yandex GPT**: AI модель для обработки естественного языка
- **Yandex SpeechKit**: Сервис распознавания речи

## Requirements

### Requirement 1: Автоматическое извлечение данных из сообщений

**User Story:** Как пользователь, я хочу писать естественным языком, чтобы система автоматически создавала задачи, расходы и заметки без команд.

#### Acceptance Criteria

1. WHEN пользователь отправляет сообщение "потратил 500₽ на кофе", THE MISIX System SHALL автоматически создать запись расхода с суммой 500₽ и категорией "еда и напитки"

2. WHEN пользователь отправляет сообщение "напомни завтра купить молоко", THE MISIX System SHALL автоматически создать задачу "купить молоко" с дедлайном на завтра

3. WHEN пользователь отправляет сообщение "запомни что встреча в офисе на Ленина 5", THE MISIX System SHALL автоматически создать заметку с содержимым о встрече

4. WHEN пользователь отправляет сообщение "сегодня отличное настроение", THE MISIX System SHALL автоматически сохранить запись настроения с положительной оценкой

5. WHEN пользователь отправляет сообщение с несколькими намерениями "потратил 200₽ на такси и напомни купить молоко", THE MISIX System SHALL создать и расход, и задачу

### Requirement 2: Классификация намерений

**User Story:** Как система, я должна определять намерения пользователя, чтобы правильно обрабатывать сообщения.

#### Acceptance Criteria

1. WHEN пользователь отправляет сообщение, THE MISIX System SHALL классифицировать намерение с использованием Yandex GPT

2. THE MISIX System SHALL поддерживать следующие типы намерений: create_task, add_expense, add_income, save_note, track_mood, general_chat

3. WHEN система определяет несколько намерений в одном сообщении, THE MISIX System SHALL обработать все намерения с confidence > 0.7

4. WHEN намерение имеет confidence < 0.7, THE MISIX System SHALL пропустить это намерение и обработать сообщение как general_chat

5. THE MISIX System SHALL логировать все классифицированные намерения с их confidence scores

### Requirement 3: Обработка голосовых сообщений

**User Story:** Как пользователь, я хочу отправлять голосовые сообщения, чтобы быстро взаимодействовать с ассистентом без набора текста.

#### Acceptance Criteria

1. WHEN пользователь отправляет голосовое сообщение, THE MISIX System SHALL скачать аудио файл в течение 10 секунд

2. WHEN аудио файл скачан, THE MISIX System SHALL транскрибировать его с использованием Yandex SpeechKit в течение 30 секунд

3. WHEN транскрипция получена, THE MISIX System SHALL обработать текст как обычное текстовое сообщение

4. WHEN транскрипция не удалась, THE MISIX System SHALL отправить пользователю сообщение об ошибке с предложением повторить

5. THE MISIX System SHALL отображать транскрибированный текст пользователю перед обработкой

### Requirement 4: Интеграция модулей с ботом

**User Story:** Как разработчик, я хочу чтобы все модули (задачи, финансы, заметки, настроение) были интегрированы с ботом, чтобы данные автоматически сохранялись.

#### Acceptance Criteria

1. WHEN система классифицирует намерение create_task, THE MISIX System SHALL вызвать TaskService для создания задачи

2. WHEN система классифицирует намерение add_expense или add_income, THE MISIX System SHALL вызвать FinanceService для создания записи

3. WHEN система классифицирует намерение save_note, THE MISIX System SHALL вызвать NoteService для создания заметки

4. WHEN система классифицирует намерение track_mood, THE MISIX System SHALL вызвать MoodService для сохранения настроения

5. WHEN создание entity успешно, THE MISIX System SHALL отправить пользователю подтверждение с деталями созданного объекта

### Requirement 5: Команды бота

**User Story:** Как пользователь, я хочу использовать команды для быстрого доступа к функциям, чтобы управлять своими данными.

#### Acceptance Criteria

1. WHEN пользователь отправляет /start, THE MISIX System SHALL приветствовать пользователя и создать профиль если его нет

2. WHEN пользователь отправляет /help, THE MISIX System SHALL показать список доступных команд и примеры использования

3. WHEN пользователь отправляет /tasks, THE MISIX System SHALL показать список активных задач с возможностью отметить выполненные

4. WHEN пользователь отправляет /finances, THE MISIX System SHALL показать сводку по финансам за текущий месяц

5. WHEN пользователь отправляет /mood, THE MISIX System SHALL показать историю настроения за последнюю неделю

6. WHEN пользователь отправляет /settings, THE MISIX System SHALL показать настройки с возможностью изменения параметров

### Requirement 6: Напоминания о задачах

**User Story:** Как пользователь, я хочу получать напоминания о задачах, чтобы не забывать о важных делах.

#### Acceptance Criteria

1. WHEN задача имеет deadline и до него остается 1 час, THE MISIX System SHALL отправить напоминание пользователю

2. WHEN наступает deadline задачи, THE MISIX System SHALL отправить финальное напоминание

3. WHEN наступает 9:00 утра, THE MISIX System SHALL отправить ежедневную сводку задач на день

4. WHEN пользователь отключает напоминания через /reminders, THE MISIX System SHALL прекратить отправку уведомлений

5. THE MISIX System SHALL проверять задачи на напоминания каждые 5 минут

### Requirement 7: Контекстная память

**User Story:** Как пользователь, я хочу чтобы ассистент помнил контекст разговора, чтобы общение было естественным.

#### Acceptance Criteria

1. THE MISIX System SHALL сохранять последние 10 сообщений пользователя и ассистента

2. WHEN генерируется ответ AI, THE MISIX System SHALL включать контекст последних сообщений

3. WHEN пользователь ссылается на предыдущее сообщение ("добавь это в задачи"), THE MISIX System SHALL использовать контекст для понимания

4. THE MISIX System SHALL очищать старый контекст (> 24 часов) для оптимизации

5. THE MISIX System SHALL хранить контекст отдельно для каждого пользователя

### Requirement 8: Обработка ошибок

**User Story:** Как пользователь, я хочу получать понятные сообщения об ошибках, чтобы знать что пошло не так.

#### Acceptance Criteria

1. WHEN происходит ошибка при обработке сообщения, THE MISIX System SHALL отправить пользователю понятное сообщение об ошибке

2. WHEN Yandex GPT недоступен, THE MISIX System SHALL использовать fallback responses

3. WHEN база данных недоступна, THE MISIX System SHALL уведомить пользователя и предложить повторить позже

4. WHEN транскрипция голоса не удалась, THE MISIX System SHALL предложить отправить текстовое сообщение

5. THE MISIX System SHALL логировать все ошибки с полным stack trace для отладки

### Requirement 9: Производительность

**User Story:** Как пользователь, я хочу получать быстрые ответы, чтобы взаимодействие было комфортным.

#### Acceptance Criteria

1. THE MISIX System SHALL отвечать на текстовые сообщения в течение 3 секунд

2. THE MISIX System SHALL обрабатывать голосовые сообщения в течение 40 секунд (10 сек скачивание + 30 сек транскрипция)

3. THE MISIX System SHALL использовать индексы БД для быстрого поиска данных пользователя

4. THE MISIX System SHALL кэшировать часто запрашиваемые данные (настройки пользователя)

5. THE MISIX System SHALL обрабатывать до 100 сообщений в минуту от одного пользователя

### Requirement 10: Безопасность данных

**User Story:** Как пользователь, я хочу чтобы мои данные были защищены, чтобы никто не мог получить к ним доступ.

#### Acceptance Criteria

1. THE MISIX System SHALL хранить все данные пользователя с привязкой к user_id

2. THE MISIX System SHALL использовать JWT токены для аутентификации веб-пользователей

3. THE MISIX System SHALL валидировать все входные данные перед сохранением в БД

4. THE MISIX System SHALL использовать HTTPS для всех API запросов

5. THE MISIX System SHALL применять rate limiting для защиты от злоупотреблений

### Requirement 11: Веб-дашборд

**User Story:** Как пользователь, я хочу видеть свои данные в веб-интерфейсе, чтобы управлять ими с компьютера.

#### Acceptance Criteria

1. WHEN пользователь открывает дашборд, THE MISIX System SHALL показать сводку по всем модулям (задачи, финансы, заметки, настроение)

2. WHEN пользователь кликает на модуль, THE MISIX System SHALL показать детальную информацию с возможностью редактирования

3. THE MISIX System SHALL синхронизировать данные между ботом и веб-интерфейсом в реальном времени

4. THE MISIX System SHALL показывать графики и статистику по финансам и настроению

5. THE MISIX System SHALL позволять создавать новые записи через веб-форму

### Requirement 12: Тестирование

**User Story:** Как разработчик, я хочу иметь автоматические тесты, чтобы гарантировать качество кода.

#### Acceptance Criteria

1. THE MISIX System SHALL иметь unit тесты для всех сервисов с coverage > 70%

2. THE MISIX System SHALL иметь integration тесты для API endpoints

3. THE MISIX System SHALL иметь тесты для intent classification с примерами сообщений

4. THE MISIX System SHALL иметь тесты для data extraction с валидацией результатов

5. THE MISIX System SHALL запускать все тесты перед деплоем в production
