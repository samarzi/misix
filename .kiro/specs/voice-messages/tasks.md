# Implementation Plan - Voice Messages Support

- [x] 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é YandexSpeechKit
  - –ü—Ä–æ—á–∏—Ç–∞—Ç—å —Ñ–∞–π–ª yandex_speech.py
  - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ –º–µ—Ç–æ–¥–∞ transcribe_audio
  - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫
  - –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ API key –Ω–∞—Å—Ç—Ä–æ–µ–Ω
  - _Requirements: 2.1, 2.5_

- [x] 2. –°–æ–∑–¥–∞—Ç—å helper —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è mock update
  - –°–æ–∑–¥–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é create_mock_text_update –≤ message.py
  - –§—É–Ω–∫—Ü–∏—è –¥–æ–ª–∂–Ω–∞ –∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å voice update
  - –ó–∞–º–µ–Ω–∏—Ç—å voice –Ω–∞ text
  - –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ –ø–æ–ª—è (user, chat, etc.)
  - _Requirements: 3.1_

- [x] 3. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å handle_voice_message
  - –ó–∞–º–µ–Ω–∏—Ç—å –∑–∞–≥–ª—É—à–∫—É –Ω–∞ –ø–æ–ª–Ω—É—é —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é
  - –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
  - _Requirements: 1.1, 1.2, 1.3, 1.4, 2.1, 2.2, 2.3, 3.1, 3.2, 3.3, 3.4, 3.5, 4.1, 4.2, 4.3, 4.5_

- [x] 3.1 –î–æ–±–∞–≤–∏—Ç—å –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä "–ø–µ—á–∞—Ç–∞–µ—Ç"
  - –û—Ç–ø—Ä–∞–≤–∏—Ç—å chat action "typing" —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è –≥–æ–ª–æ—Å–æ–≤–æ–≥–æ
  - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å context.bot.send_chat_action
  - _Requirements: 4.1_

- [x] 3.2 –°–∫–∞—á–∞—Ç—å –∞—É–¥–∏–æ —Ñ–∞–π–ª
  - –ü–æ–ª—É—á–∏—Ç—å file —á–µ—Ä–µ–∑ context.bot.get_file(voice.file_id)
  - –°–∫–∞—á–∞—Ç—å –∫–∞–∫ bytearray —á–µ—Ä–µ–∑ download_as_bytearray()
  - –ó–∞–ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–∑–º–µ—Ä –∏ –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
  - –û–±—Ä–∞–±–æ—Ç–∞—Ç—å –æ—à–∏–±–∫–∏ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è
  - _Requirements: 1.1, 1.2, 1.4, 5.4_

- [x] 3.3 –¢—Ä–∞–Ω—Å–∫—Ä–∏–±–∏—Ä–æ–≤–∞—Ç—å —á–µ—Ä–µ–∑ Yandex SpeechKit
  - –ü–æ–ª—É—á–∏—Ç—å —ç–∫–∑–µ–º–ø–ª—è—Ä YandexSpeechKit
  - –í—ã–∑–≤–∞—Ç—å transcribe_audio —Å audio bytes
  - –ó–∞–ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏–∏
  - –û–±—Ä–∞–±–æ—Ç–∞—Ç—å —Å–ª—É—á–∞–π –ø—É—Å—Ç–æ–π —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏–∏
  - –û–±—Ä–∞–±–æ—Ç–∞—Ç—å –æ—à–∏–±–∫–∏ API
  - _Requirements: 2.1, 2.2, 2.3, 2.4, 2.5, 5.2_

- [x] 3.4 –ü–æ–∫–∞–∑–∞—Ç—å —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
  - –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ —Å —Ä–∞—Å–ø–æ–∑–Ω–∞–Ω–Ω—ã–º —Ç–µ–∫—Å—Ç–æ–º
  - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç–º–æ–¥–∑–∏ üé§ –¥–ª—è –Ω–∞–≥–ª—è–¥–Ω–æ—Å—Ç–∏
  - –î–æ–±–∞–≤–∏—Ç—å "–û–±—Ä–∞–±–∞—Ç—ã–≤–∞—é..." –¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑–∏
  - _Requirements: 4.2_

- [x] 3.5 –û–±—Ä–∞–±–æ—Ç–∞—Ç—å –∫–∞–∫ —Ç–µ–∫—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
  - –°–æ–∑–¥–∞—Ç—å mock update —Å —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∏—Ä–æ–≤–∞–Ω–Ω—ã–º —Ç–µ–∫—Å—Ç–æ–º
  - –í—ã–∑–≤–∞—Ç—å handle_text_message —Å mock update
  - –≠—Ç–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±—Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞–º–µ—Ä–µ–Ω–∏—è –∏ —Å–æ–∑–¥–∞—Å—Ç —Å—É—â–Ω–æ—Å—Ç–∏
  - _Requirements: 3.1, 3.2, 3.3, 3.4, 3.5_

- [x] 3.6 –î–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫
  - Try-except –±–ª–æ–∫ –≤–æ–∫—Ä—É–≥ –≤—Å–µ–π –ª–æ–≥–∏–∫–∏
  - –°–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –æ—à–∏–±–æ–∫
  - –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –æ—à–∏–±–æ–∫
  - –ü–æ–Ω—è—Ç–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
  - _Requirements: 1.5, 2.5, 4.5, 5.3_

- [ ] 4. –î–æ–±–∞–≤–∏—Ç—å timeout –∏ cleanup
  - –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å timeout –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è (10 —Å–µ–∫)
  - –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å timeout –¥–ª—è —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏–∏ (30 —Å–µ–∫)
  - –£–¥–∞–ª—è—Ç—å –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã –µ—Å–ª–∏ —Å–æ–∑–¥–∞—é—Ç—Å—è
  - –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –≤—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏
  - _Requirements: 5.1, 5.2, 5.4, 5.5_

- [ ]* 5. –ù–∞–ø–∏—Å–∞—Ç—å unit —Ç–µ—Å—Ç—ã
  - –¢–µ—Å—Ç create_mock_text_update
  - –¢–µ—Å—Ç handle_voice_message —Å mock —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏–µ–π
  - –¢–µ—Å—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫
  - _Requirements: 1.1, 2.1, 3.1_

- [ ]* 6. –ù–∞–ø–∏—Å–∞—Ç—å integration —Ç–µ—Å—Ç—ã
  - –¢–µ—Å—Ç —Å —Ä–µ–∞–ª—å–Ω—ã–º Yandex SpeechKit (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–µ–Ω)
  - –¢–µ—Å—Ç end-to-end –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≥–æ–ª–æ—Å–æ–≤–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
  - –¢–µ—Å—Ç —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–¥–∞—á–∏ —á–µ—Ä–µ–∑ –≥–æ–ª–æ—Å
  - –¢–µ—Å—Ç —Å–æ–∑–¥–∞–Ω–∏—è —Ä–∞—Å—Ö–æ–¥–∞ —á–µ—Ä–µ–∑ –≥–æ–ª–æ—Å
  - _Requirements: 3.1, 3.2, 3.3, 3.4, 3.5_
