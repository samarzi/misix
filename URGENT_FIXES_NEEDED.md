# üö® –°—Ä–æ—á–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–ª—è MISIX

**–î–∞—Ç–∞:** 20 –Ω–æ—è–±—Ä—è 2025  
**–ü—Ä–æ–±–ª–µ–º—ã:** 3 –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ

---

## ‚ùå –ü—Ä–æ–±–ª–µ–º—ã

### 1. –ì–æ–ª–æ—Å–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è —Ä–∞—Å–ø–æ–∑–Ω–∞—é—Ç—Å—è, –Ω–æ –Ω–µ—Ç –æ—Ç–≤–µ—Ç–∞
**–ü—Ä–∏—á–∏–Ω–∞:** –ö–æ–¥ –≤ `handle_voice_message` –æ–±—Ä—ã–≤–∞–ª—Å—è –Ω–∞ —Å—Ç—Ä–æ–∫–µ 200  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û

### 2. –ö–Ω–æ–ø–∫–∏ "–ü–æ–º–æ—â—å" –∏ "–Ø —Å–ø–∞—Ç—å" –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç
**–ü—Ä–∏—á–∏–Ω–∞:** –ù–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω—ã callback handlers  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û

### 3. –í–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
**–ü—Ä–∏—á–∏–Ω–∞:** –ù—É–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å API endpoint  
**–°—Ç–∞—Ç—É—Å:** ‚è≥ –¢–†–ï–ë–£–ï–¢ –ù–ê–°–¢–†–û–ô–ö–ò

---

## ‚úÖ –ß—Ç–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

### 1. –ì–æ–ª–æ—Å–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è (backend/app/bot/handlers/message.py)
- –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –ø–æ–ª–Ω—ã–π –∫–æ–¥ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≥–æ–ª–æ—Å–æ–≤—ã—Ö
- –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—è
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∫–∞–∫ —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
- –î–æ–±–∞–≤–ª–µ–Ω—ã –≤—Å–µ error handlers

### 2. –ö–Ω–æ–ø–∫–∏ (backend/app/bot/handlers/command.py + __init__.py)
- –î–æ–±–∞–≤–ª–µ–Ω—ã inline –∫–Ω–æ–ø–∫–∏ –≤ /start
- –°–æ–∑–¥–∞–Ω `handle_quick_action_callback` –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏
- –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω callback handler –≤ –±–æ—Ç–µ
- –ö–Ω–æ–ø–∫–∏: –ü–æ–º–æ—â—å, –ó–∞–¥–∞—á–∏, –§–∏–Ω–∞–Ω—Å—ã, –ù–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ, –Ø —Å–ø–∞—Ç—å

### 3. –ö–æ–º–∞–Ω–¥–∞ "–Ø —Å–ø–∞—Ç—å" (backend/app/bot/handlers/sleep.py)
- –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –±–∞–∑–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å
- –î–æ–±–∞–≤–ª–µ–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ —Å–Ω–∞
- –î–æ–±–∞–≤–ª–µ–Ω—ã –¥—Ä—É–∂–µ–ª—é–±–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã

---

## üöÄ –ö–∞–∫ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å

### –ó–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞:

```bash
cd backend
source venv/bin/activate  # –∏–ª–∏ .venv/bin/activate
python test_bot_quick.py
```

### –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ Telegram:

1. **–ì–æ–ª–æ—Å–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è:**
   - –û—Ç–ø—Ä–∞–≤—å –≥–æ–ª–æ—Å–æ–≤–æ–µ: "–Ω–∞–ø–æ–º–Ω–∏ –∫—É–ø–∏—Ç—å –º–æ–ª–æ–∫–æ"
   - –î–æ–ª–∂–Ω–æ —Ä–∞—Å–ø–æ–∑–Ω–∞—Ç—å—Å—è –∏ —Å–æ–∑–¥–∞—Ç—å –∑–∞–¥–∞—á—É

2. **–ö–Ω–æ–ø–∫–∏:**
   - –û—Ç–ø—Ä–∞–≤—å `/start`
   - –ù–∞–∂–º–∏ –∫–Ω–æ–ø–∫—É "‚ùì –ü–æ–º–æ—â—å" - –¥–æ–ª–∂–Ω–∞ –ø–æ–∫–∞–∑–∞—Ç—å—Å—è —Å–ø—Ä–∞–≤–∫–∞
   - –ù–∞–∂–º–∏ –∫–Ω–æ–ø–∫—É "üõå –Ø —Å–ø–∞—Ç—å" - –¥–æ–ª–∂–µ–Ω –æ—Ç–≤–µ—Ç–∏—Ç—å

3. **–ö–æ–º–∞–Ω–¥—ã:**
   - `/help` - —Å–ø—Ä–∞–≤–∫–∞
   - `/tasks` - —Å–ø–∏—Å–æ–∫ –∑–∞–¥–∞—á
   - `/finances` - —Ñ–∏–Ω–∞–Ω—Å—ã
   - `/mood` - –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ
   - `/sleep` - –Ω–∞—á–∞—Ç—å —Ç—Ä–µ–∫–∏–Ω–≥ —Å–Ω–∞
   - `/wake` - –∑–∞–∫–æ–Ω—á–∏—Ç—å —Ç—Ä–µ–∫–∏–Ω–≥ —Å–Ω–∞

---

## üåê –í–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

### –ü—Ä–æ–±–ª–µ–º–∞:
Frontend –ø—ã—Ç–∞–µ—Ç—Å—è –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ API, –Ω–æ –Ω—É–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å:

### –†–µ—à–µ–Ω–∏–µ:

#### 1. –ü—Ä–æ–≤–µ—Ä—å .env —Ñ–∞–π–ª –≤ frontend:

```bash
cd frontend
cat .env.local  # –∏–ª–∏ .env
```

–î–æ–ª–∂–Ω–æ –±—ã—Ç—å:
```
VITE_API_BASE_URL=http://localhost:8000
```

#### 2. –ï—Å–ª–∏ —Ñ–∞–π–ª–∞ –Ω–µ—Ç, —Å–æ–∑–¥–∞–π:

```bash
cd frontend
echo "VITE_API_BASE_URL=http://localhost:8000" > .env.local
```

#### 3. –ó–∞–ø—É—Å—Ç–∏ backend API:

```bash
cd backend
source venv/bin/activate
uvicorn app.web.main:app --reload --host 0.0.0.0 --port 8000
```

#### 4. –í –Ω–æ–≤–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ –∑–∞–ø—É—Å—Ç–∏ frontend:

```bash
cd frontend
npm run dev
```

#### 5. –û—Ç–∫—Ä–æ–π –≤ –±—Ä–∞—É–∑–µ—Ä–µ:
```
http://localhost:5173
```

---

## üìù –ò–∑–º–µ–Ω—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

### Backend:
1. `backend/app/bot/handlers/message.py` - –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∫–æ–¥ –≥–æ–ª–æ—Å–æ–≤—ã—Ö
2. `backend/app/bot/handlers/command.py` - –¥–æ–±–∞–≤–ª–µ–Ω—ã –∫–Ω–æ–ø–∫–∏ –∏ callback handler
3. `backend/app/bot/handlers/sleep.py` - —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å —Å–Ω–∞
4. `backend/app/bot/__init__.py` - –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω –Ω–æ–≤—ã–π callback handler
5. `backend/test_bot_quick.py` - –Ω–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### Frontend:
- –ù—É–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å `.env.local` —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º API URL

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –¢–µ—Å—Ç 1: –ì–æ–ª–æ—Å–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è

```
–î–µ–π—Å—Ç–≤–∏–µ: –û—Ç–ø—Ä–∞–≤—å –≥–æ–ª–æ—Å–æ–≤–æ–µ "–Ω–∞–ø–æ–º–Ω–∏ –∑–∞–≤—Ç—Ä–∞ –∫—É–ø–∏—Ç—å –º–æ–ª–æ–∫–æ"

–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:
1. –ë–æ—Ç: "üé§ –†–∞—Å–ø–æ–∑–Ω–∞–Ω–æ: "–Ω–∞–ø–æ–º–Ω–∏ –∑–∞–≤—Ç—Ä–∞ –∫—É–ø–∏—Ç—å –º–æ–ª–æ–∫–æ""
2. –ë–æ—Ç: "–û–±—Ä–∞–±–∞—Ç—ã–≤–∞—é..."
3. –ë–æ—Ç: "‚úÖ –°–æ–∑–¥–∞–ª –∑–∞–¥–∞—á—É: –∫—É–ø–∏—Ç—å –º–æ–ª–æ–∫–æ (–¥–æ 21.11.2025)"

–ï—Å–ª–∏ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:
- –ü—Ä–æ–≤–µ—Ä—å –ª–æ–≥–∏ –±–æ—Ç–∞
- –ü—Ä–æ–≤–µ—Ä—å YANDEX_GPT_API_KEY –≤ .env
- –ü—Ä–æ–≤–µ—Ä—å YANDEX_FOLDER_ID –≤ .env
```

### –¢–µ—Å—Ç 2: –ö–Ω–æ–ø–∫–∏

```
–î–µ–π—Å—Ç–≤–∏–µ: –û—Ç–ø—Ä–∞–≤—å /start, –Ω–∞–∂–º–∏ "‚ùì –ü–æ–º–æ—â—å"

–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:
–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –ø–æ–ª–Ω–∞—è —Å–ø—Ä–∞–≤–∫–∞ —Å –∫–æ–º–∞–Ω–¥–∞–º–∏

–ï—Å–ª–∏ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:
- –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏ –±–æ—Ç–∞
- –ü—Ä–æ–≤–µ—Ä—å –ª–æ–≥–∏ –Ω–∞ –æ—à–∏–±–∫–∏
```

### –¢–µ—Å—Ç 3: –ö–æ–º–∞–Ω–¥–∞ "–Ø —Å–ø–∞—Ç—å"

```
–î–µ–π—Å—Ç–≤–∏–µ: –ù–∞–∂–º–∏ –∫–Ω–æ–ø–∫—É "üõå –Ø —Å–ø–∞—Ç—å" –∏–ª–∏ –æ—Ç–ø—Ä–∞–≤—å /sleep

–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:
"üõå –°–ø–æ–∫–æ–π–Ω–æ–π –Ω–æ—á–∏! –Ø –∑–∞–ø–æ–º–Ω–∏–ª, —á—Ç–æ –≤—ã –ª–µ–≥–ª–∏ —Å–ø–∞—Ç—å.
–ù–∞–ø–∏—à–∏—Ç–µ /wake –∫–æ–≥–¥–∞ –ø—Ä–æ—Å–Ω–µ—Ç–µ—Å—å, —á—Ç–æ–±—ã —è –∑–∞–ø–∏—Å–∞–ª –ø—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–Ω–∞."

–ï—Å–ª–∏ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:
- –ü—Ä–æ–≤–µ—Ä—å –ª–æ–≥–∏
- –ü—Ä–æ–≤–µ—Ä—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
```

---

## üêõ –ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

### 1. –ü—Ä–æ–≤–µ—Ä—å –ª–æ–≥–∏ –±–æ—Ç–∞:
```bash
cd backend
python test_bot_quick.py
# –°–º–æ—Ç—Ä–∏ –≤—ã–≤–æ–¥ –≤ –∫–æ–Ω—Å–æ–ª–∏
```

### 2. –ü—Ä–æ–≤–µ—Ä—å .env —Ñ–∞–π–ª:
```bash
cd backend
cat .env | grep -E "TELEGRAM_BOT_TOKEN|YANDEX"
```

–î–æ–ª–∂–Ω–æ –±—ã—Ç—å:
```
TELEGRAM_BOT_TOKEN=7...
YANDEX_GPT_API_KEY=...
YANDEX_FOLDER_ID=...
```

### 3. –ü—Ä–æ–≤–µ—Ä—å –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö:
```bash
cd backend
python diagnose.py
```

### 4. –ü—Ä–æ–≤–µ—Ä—å –≤–µ—Ä—Å–∏—é Python:
```bash
python --version
# –î–æ–ª–∂–Ω–æ –±—ã—Ç—å: Python 3.11.x
```

---

## üìû –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

### –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:

1. ‚úÖ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π –≤—Å–µ 3 —Ñ—É–Ω–∫—Ü–∏–∏
2. ‚úÖ –£–±–µ–¥–∏—Å—å —á—Ç–æ –≥–æ–ª–æ—Å–æ–≤—ã–µ —Ä–∞–±–æ—Ç–∞—é—Ç
3. ‚úÖ –£–±–µ–¥–∏—Å—å —á—Ç–æ –∫–Ω–æ–ø–∫–∏ —Ä–∞–±–æ—Ç–∞—é—Ç
4. ‚è≥ –ù–∞—Å—Ç—Ä–æ–π –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
5. ‚è≥ –ó–∞–¥–µ–ø–ª–æ–π –Ω–∞ Render

### –î–ª—è –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:

1. –°–æ–∑–¥–∞–π `.env.local` –≤ frontend
2. –ó–∞–ø—É—Å—Ç–∏ backend API
3. –ó–∞–ø—É—Å—Ç–∏ frontend dev server
4. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π –≤ –±—Ä–∞—É–∑–µ—Ä–µ

---

## üéØ –ò—Ç–æ–≥–∏

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:
- ‚úÖ –ì–æ–ª–æ—Å–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è —Ç–µ–ø–µ—Ä—å –æ—Ç–≤–µ—á–∞—é—Ç
- ‚úÖ –ö–Ω–æ–ø–∫–∏ "–ü–æ–º–æ—â—å" –∏ "–Ø —Å–ø–∞—Ç—å" —Ä–∞–±–æ—Ç–∞—é—Ç
- ‚úÖ –ö–æ–º–∞–Ω–¥–∞ /sleep —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞

### –¢—Ä–µ–±—É–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:
- ‚è≥ –í–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (–Ω—É–∂–µ–Ω .env.local)

### –ì–æ—Ç–æ–≤–æ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é:
- ‚úÖ Telegram –±–æ—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ –í—Å–µ –∫–æ–º–∞–Ω–¥—ã —Ä–∞–±–æ—Ç–∞—é—Ç
- ‚úÖ –ì–æ–ª–æ—Å–æ–≤—ã–µ —Ä–∞–±–æ—Ç–∞—é—Ç
- ‚úÖ –ö–Ω–æ–ø–∫–∏ —Ä–∞–±–æ—Ç–∞—é—Ç

---

**–ó–∞–ø—É—Å—Ç–∏ –±–æ—Ç–∞ –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π!** üöÄ

```bash
cd backend
source venv/bin/activate
python test_bot_quick.py
```

–ó–∞—Ç–µ–º –æ—Ç–ø—Ä–∞–≤—å –±–æ—Ç—É:
1. –ì–æ–ª–æ—Å–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
2. /start –∏ –Ω–∞–∂–º–∏ –∫–Ω–æ–ø–∫–∏
3. /sleep

–í—Å—ë –¥–æ–ª–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å! ‚úÖ
